{"version":3,"file":"static/dist/css/send.08efd004.css","mappings":"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","sources":["webpack://front/./src/components/validation-error-messages.vue","webpack://front/VueSelect/src/components/Select.vue","webpack://front/./src/pages/mail/components/send-input-to.vue","webpack://front/./src/pages/mail/components/send-input-from.vue","webpack://front/./src/pages/mail/components/send-input-attachment-preview.vue","webpack://front/./src/pages/mail/components/send-input-attachments.vue","webpack://front/./src/pages/mail/send-confirm.vue"],"sourcesContent":["<template>\r\n  <ul>\r\n    <li\r\n      v-for=\"message in messages\"\r\n      :key=\"message\"\r\n      v-text=\"message\"\r\n      class=\"text-danger small my-1\"></li>\r\n  </ul>\r\n</template>\r\n\r\n<script>\r\nexport default {\r\n  name: \"validation-error-messages\",\r\n  props: {\r\n    messages: {required: true, type: Array}\r\n  }\r\n};\r\n</script>\r\n\r\n<style scoped>\r\nul{\r\n  list-style: none;\r\n  margin: 5px 0 0 1rem;\r\n  padding: 0;\r\n}\r\n</style>",".v-select{position:relative;font-family:inherit}.v-select,.v-select *{box-sizing:border-box}@-webkit-keyframes vSelectSpinner{0%{transform:rotate(0deg)}to{transform:rotate(1turn)}}@keyframes vSelectSpinner{0%{transform:rotate(0deg)}to{transform:rotate(1turn)}}.vs__fade-enter-active,.vs__fade-leave-active{pointer-events:none;transition:opacity .15s cubic-bezier(1,.5,.8,1)}.vs__fade-enter,.vs__fade-leave-to{opacity:0}.vs--disabled .vs__clear,.vs--disabled .vs__dropdown-toggle,.vs--disabled .vs__open-indicator,.vs--disabled .vs__search,.vs--disabled .vs__selected{cursor:not-allowed;background-color:#f8f8f8}.v-select[dir=rtl] .vs__actions{padding:0 3px 0 6px}.v-select[dir=rtl] .vs__clear{margin-left:6px;margin-right:0}.v-select[dir=rtl] .vs__deselect{margin-left:0;margin-right:2px}.v-select[dir=rtl] .vs__dropdown-menu{text-align:right}.vs__dropdown-toggle{-webkit-appearance:none;-moz-appearance:none;appearance:none;display:flex;padding:0 0 4px;background:none;border:1px solid rgba(60,60,60,.26);border-radius:4px;white-space:normal}.vs__selected-options{display:flex;flex-basis:100%;flex-grow:1;flex-wrap:wrap;padding:0 2px;position:relative}.vs__actions{display:flex;align-items:center;padding:4px 6px 0 3px}.vs--searchable .vs__dropdown-toggle{cursor:text}.vs--unsearchable .vs__dropdown-toggle{cursor:pointer}.vs--open .vs__dropdown-toggle{border-bottom-color:transparent;border-bottom-left-radius:0;border-bottom-right-radius:0}.vs__open-indicator{fill:rgba(60,60,60,.5);transform:scale(1);transition:transform .15s cubic-bezier(1,-.115,.975,.855);transition-timing-function:cubic-bezier(1,-.115,.975,.855)}.vs--open .vs__open-indicator{transform:rotate(180deg) scale(1)}.vs--loading .vs__open-indicator{opacity:0}.vs__clear{fill:rgba(60,60,60,.5);padding:0;border:0;background-color:transparent;cursor:pointer;margin-right:8px}.vs__dropdown-menu{display:block;box-sizing:border-box;position:absolute;top:calc(100% - 1px);left:0;z-index:1000;padding:5px 0;margin:0;width:100%;max-height:350px;min-width:160px;overflow-y:auto;box-shadow:0 3px 6px 0 rgba(0,0,0,.15);border:1px solid rgba(60,60,60,.26);border-top-style:none;border-radius:0 0 4px 4px;text-align:left;list-style:none;background:#fff}.vs__no-options{text-align:center}.vs__dropdown-option{line-height:1.42857143;display:block;padding:3px 20px;clear:both;color:#333;white-space:nowrap;cursor:pointer}.vs__dropdown-option--highlight{background:#5897fb;color:#fff}.vs__dropdown-option--deselect{background:#fb5858;color:#fff}.vs__dropdown-option--disabled{background:inherit;color:rgba(60,60,60,.5);cursor:inherit}.vs__selected{display:flex;align-items:center;background-color:#f0f0f0;border:1px solid rgba(60,60,60,.26);border-radius:4px;color:#333;line-height:1.4;margin:4px 2px 0;padding:0 .25em;z-index:0}.vs__deselect{display:inline-flex;-webkit-appearance:none;-moz-appearance:none;appearance:none;margin-left:4px;padding:0;border:0;cursor:pointer;background:none;fill:rgba(60,60,60,.5);text-shadow:0 1px 0 #fff}.vs--single .vs__selected{background-color:transparent;border-color:transparent}.vs--single.vs--loading .vs__selected,.vs--single.vs--open .vs__selected{position:absolute;opacity:.4}.vs--single.vs--searching .vs__selected{display:none}.vs__search::-webkit-search-cancel-button{display:none}.vs__search::-ms-clear,.vs__search::-webkit-search-decoration,.vs__search::-webkit-search-results-button,.vs__search::-webkit-search-results-decoration{display:none}.vs__search,.vs__search:focus{-webkit-appearance:none;-moz-appearance:none;appearance:none;line-height:1.4;font-size:1em;border:1px solid transparent;border-left:none;outline:none;margin:4px 0 0;padding:0 7px;background:none;box-shadow:none;width:0;max-width:100%;flex-grow:1;z-index:1}.vs__search::-webkit-input-placeholder{color:inherit}.vs__search::-moz-placeholder{color:inherit}.vs__search:-ms-input-placeholder{color:inherit}.vs__search::-ms-input-placeholder{color:inherit}.vs__search::placeholder{color:inherit}.vs--unsearchable .vs__search{opacity:1}.vs--unsearchable:not(.vs--disabled) .vs__search{cursor:pointer}.vs--single.vs--searching:not(.vs--open):not(.vs--loading) .vs__search{opacity:.2}.vs__spinner{align-self:center;opacity:0;font-size:5px;text-indent:-9999em;overflow:hidden;border:.9em solid hsla(0,0%,39.2%,.1);border-left-color:rgba(60,60,60,.45);transform:translateZ(0);-webkit-animation:vSelectSpinner 1.1s linear infinite;animation:vSelectSpinner 1.1s linear infinite;transition:opacity .1s}.vs__spinner,.vs__spinner:after{border-radius:50%;width:5em;height:5em}.vs--loading .vs__spinner{opacity:1}","<template>\r\n  <div>\r\n    <div class=\"my-2\">\r\n      <div class=\"v-select-label\">\r\n      To: \r\n      </div>\r\n      <div class=\"v-select-wraper\">\r\n        <v-select\r\n          v-model=\"tos\"\r\n          :options=\"years\"\r\n          label=\"label\"\r\n          multiple\r\n        >\r\n        </v-select>\r\n      </div>\r\n    </div>\r\n    <validation-error-messages\r\n      v-if=\"error_messages.length > 0 && is_dirty\"\r\n      :messages=\"error_messages\" />\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport validationErrorMessages from \"../../../components/validation-error-messages.vue\";\r\nimport { computed, onMounted, ref } from \"vue\";\r\nimport { useStore } from \"vuex\";\r\nimport axios from \"../../../utils/axios\";\r\nimport vSelect from \"vue-select\";\r\nimport \"vue-select/dist/vue-select.css\";\r\nexport default {\r\n  components: {\r\n    validationErrorMessages,\r\n    vSelect\r\n  },\r\n  setup() {\r\n    const store = useStore();\r\n    const tos = computed({\r\n      get: () => store.state.send.tos[\"value\"],\r\n      set: value => store.commit(\"send/setTos\", value)\r\n    });\r\n    const is_dirty = computed(() => store.state.send.tos[\"is_dirty\"]);\r\n    const error_messages = computed(() => store.state.send.tos[\"error_messages\"]);\r\n\r\n    const toGrouplabel = year => `${String(year)} ${String(year - 1994)}期`;\r\n    const userYear = store.state.user.year;\r\n    // 選択肢\r\n    const years = ref([\r\n      {\r\n        year: 0,\r\n        label: \"全回メーリス\"\r\n      },\r\n      {\r\n        year: userYear,\r\n        label: toGrouplabel(userYear)\r\n      }\r\n    ]);\r\n    onMounted(() => {\r\n      axios.get(\"/api/board/send/togroups/\").then(res => {\r\n        years.value.length = 0;\r\n        res.data.togropus.forEach(y => {\r\n          years.value.push(y);\r\n        });\r\n      });\r\n    });\r\n    return {\r\n      tos, is_dirty, error_messages, years\r\n    };\r\n  }\r\n};\r\n</script>\r\n\r\n<style scoped>\r\n.v-select-label{\r\n  display: inline-block;\r\n  width: 3rem;\r\n}\r\n.v-select-wraper{\r\n  display: inline-block;\r\n  width: calc(100% - 4rem);\r\n}\r\n</style>","<template>\r\n  <div>\r\n  <div class=\"my-2\">\r\n    <div class=\"v-select-label\">\r\n     From: \r\n    </div>\r\n    <select name=\"year_choice\" v-model=\"selectedYear\" class=\"form-control\" id=\"year_choice\">\r\n      <option v-for=\"year in years\" :value=\"year\" :key=\"year\">\r\n        {{year}}\r\n      </option>\r\n    </select>\r\n    <select name=\"member_choice\" v-model=\"writer\" class=\"form-control\" id=\"member_choice\">\r\n      <option v-for=\"member in memberChoices\" :value=\"member\" :key=\"member.id\">\r\n        {{member.name}}\r\n      </option>\r\n    </select>\r\n  </div>\r\n  <validation-error-messages\r\n    v-if=\"error_messages.length > 0 && is_dirty\"\r\n    :messages=\"error_messages\" />\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport validationErrorMessages from \"../../../components/validation-error-messages.vue\";\r\nimport { computed, onMounted, ref, watch } from \"vue\";\r\nimport { useStore } from \"vuex\";\r\nimport axios from \"../../../utils/axios\";\r\nexport default {\r\n  components: {\r\n    validationErrorMessages\r\n  },\r\n  setup() {\r\n    // vuexとの連携\r\n    const store = useStore();\r\n    const writer = computed({\r\n      get: () => store.state.send.writer.value,\r\n      set: value => store.commit(\"send/setWriter\", value)\r\n    });\r\n    const is_dirty = computed(() => store.state.send.writer.is_dirty);\r\n    const error_messages = computed(() => store.state.send.writer.error_messages);\r\n\r\n    // コンポーネント内ディレクティブ\r\n    const selectedYear = ref(store.state.user.year);\r\n    const years = ref([store.state.user.year]);\r\n    const members = ref([{\r\n      year: store.state.user.year,\r\n      list: [{\r\n        id: store.state.user.id,\r\n        name: store.state.user.shortname,\r\n        year: store.state.user.year\r\n      }]\r\n    }]);\r\n\r\n    // craeted時、writerが設定されていなかったら自分を設定\r\n    if (writer.value === null) {\r\n      store.commit(\"send/setWriter\", {\r\n        id: store.state.user.id,\r\n        name: store.state.user.shortname,\r\n        year: store.state.user.year\r\n      });\r\n    }\r\n\r\n    onMounted(() => {\r\n      axios.get(\"/api/board/send/froms/\").then(res => {\r\n        members.value = res.data.members;\r\n        years.value = res.data.years;\r\n      });\r\n    });\r\n\r\n    watch(selectedYear, newSelectedYear => {\r\n      if (writer.value.year !== newSelectedYear) {\r\n        store.commit(\"send/setWriter\", null);\r\n      }\r\n    });\r\n\r\n    // yearで絞り込むユーザーの選択肢\r\n    const memberChoices = computed(() => {\r\n      return members.value.find(obj => obj.year === selectedYear.value)[\"list\"];\r\n    });\r\n    \r\n    return {\r\n      writer, is_dirty, error_messages, selectedYear,\r\n      years, memberChoices\r\n    };\r\n  }\r\n};\r\n</script>\r\n\r\n<style scoped>\r\n.v-select-label{\r\n  display: inline-block;\r\n  width: 3rem;\r\n}\r\n#year_choice{\r\n  display: inline-block;\r\n  width: 5rem;\r\n  padding: 6px;\r\n}\r\n#member_choice{\r\n  display: inline-block;\r\n  width: calc(100% - 9rem);\r\n  min-width: 8rem;\r\n  max-width: 18rem;\r\n}\r\n</style>","<template>\r\n  <div class=\"preview-content-wrapper\" @click=\"openFile\">\r\n    <img v-if=\"isImage\" :src=\"imageURL\" alt=\"iamge-preview\">\r\n    <img v-else-if=\"file.type=='application/pdf'\" src=\"/static/img/board/pdf-icon.png\" alt=\"pdf-icon\">\r\n    <img v-else src=\"/static/img/board/file-icon.png\" alt=\"file-icon\">\r\n    <div class=\"preview-file-name\">{{file.name}}</div>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport { computed, ref, onMounted, onUnmounted } from \"vue\";\r\nexport default {\r\n  props: {\r\n    file: {required: true, type: File}\r\n  },\r\n  setup(props) {\r\n    const imageURL = ref(\"\");\r\n    const objectURL = ref(\"\");\r\n    const file = computed(() => props.file);\r\n\r\n    const isImage = computed(() => file.value.type.startsWith(\"image/\"));\r\n\r\n    const openFile = () => {\r\n      if (objectURL.value) {\r\n        window.open(objectURL.value, \"filePreview\");\r\n      }\r\n    };\r\n    onMounted(() => {\r\n      const reader = new FileReader();\r\n      reader.onload = e => {\r\n        imageURL.value = e.target.result;\r\n      };\r\n      reader.readAsDataURL(file.value);\r\n      objectURL.value = URL.createObjectURL(file.value);\r\n    });\r\n\r\n\r\n    onUnmounted(() => {\r\n      URL.revokeObjectURL(file.value);\r\n    });\r\n    return {\r\n      openFile, isImage, imageURL\r\n    };\r\n  }\r\n};\r\n</script>\r\n\r\n<style scoped>\r\n.preview-content-wrapper{\r\n  border: 1px solid #aaa;\r\n  border-radius: 0.3rem;\r\n  margin: 0.5rem;\r\n  padding: 0.5rem;\r\n  z-index: 1;\r\n  cursor: pointer;\r\n}\r\nimg{\r\n  width: 8rem;\r\n  height: 6rem;\r\n  object-fit: contain;\r\n}\r\n.preview-file-name{\r\n  font-size: 0.6rem;\r\n}\r\n</style>","<template>\r\n  <div class=\"attachent-wrapper p-0 my-2\">\r\n    <label\r\n      for=\"attachment-input\"\r\n      class=\"my-0\"\r\n      :class=\"{'attachment-opened':opened}\"\r\n      @dragenter=\"dragEnter\"\r\n      @dragleave=\"dragLeave\"\r\n      @dragover.prevent\r\n      @drop.prevent=\"dropFile\"\r\n    >\r\n      <span v-if=\"opened\">ここに添付するファイルをドロップ</span>\r\n      <span v-else>添付ファイルを選択、もしくはここにドラッグ＆ドロップ</span>\r\n      <input type=\"file\" multiple id=\"attachment-input\" @change=\"onFileChange\">\r\n    </label>\r\n    <div v-if=\"attachments.length>0\" class=\"small text-secondary mx-2\">\r\n      クリックすると新しいタブでファイルを確認できます\r\n    </div>\r\n    <div class=\"attachment-preview\">\r\n      <div class=\"attachment-preview-wrapper\"\r\n          v-for=\"file in attachments\"\r\n          :key=\"file.name+file.size\"\r\n        >\r\n        <attachment-preview\r\n        :file=\"file\"\r\n        />\r\n        <div\r\n          class=\"file-cansel\"\r\n          @click=\"cansel(file)\"\r\n        >×</div>\r\n      </div>\r\n    </div>\r\n    <div v-if=\"attachments.length>0\" class=\"mx-2\">\r\n      {{attachments.length}}件が選択されています\r\n    </div>\r\n    <validation-error-messages\r\n      v-if=\"error_messages.length > 0 && is_dirty\"\r\n      :messages=\"error_messages\" />\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport validationErrorMessages from \"../../../components/validation-error-messages.vue\";\r\nimport attachmentPreview from \"./send-input-attachment-preview.vue\";\r\nimport { computed, onBeforeMount, ref } from \"vue\";\r\nimport { useStore } from \"vuex\";\r\nexport default {\r\n  components: {\r\n    validationErrorMessages,\r\n    attachmentPreview\r\n  },\r\n  setup() {\r\n    // Vuex\r\n    const store = useStore();\r\n    const attachments = computed({\r\n      get: () => store.state.send.attachments[\"value\"],\r\n      set: value => store.commit(\"send/setAttachments\", value)\r\n    });\r\n    const is_dirty = computed(() => store.state.send.attachments[\"is_dirty\"]);\r\n    const error_messages = computed(() => store.state.send.attachments[\"error_messages\"]);\r\n\r\n    // display variable\r\n    const opened = ref(false);\r\n\r\n    // methods\r\n    const internalAttachments = ref([]);\r\n    const onFileChange = inputFile => {\r\n      const files = inputFile.target.files;\r\n      for (let i = 0; i < files.length; i++) {\r\n        internalAttachments.value.push(files[i]);\r\n      }\r\n      commit();\r\n    };\r\n    const dragEnter = () => { opened.value = true; };\r\n    const dragLeave = () => { opened.value = false; };\r\n    const dropFile = e => {\r\n      opened.value = false;\r\n      const files = e.dataTransfer.files;\r\n      for (let i = 0; i < files.length; i++) {\r\n        internalAttachments.value.push(files[i]);\r\n      }\r\n      commit();\r\n    };\r\n    const cansel = file => {\r\n      internalAttachments.value = internalAttachments.value.filter(f => {\r\n        return !(f.size === file.size && f.name === file.name);\r\n      });\r\n      commit();\r\n    };\r\n\r\n    const commit = () => {\r\n      // 重複してるファイルを取り除いて、Vuexに投げる\r\n      const uniques = internalAttachments.value.reduce((prev, current) => {\r\n        if (!prev.some(f => (f.size === current.size && f.name === current.name))) {\r\n          return [...prev, current];\r\n        } else {\r\n          // 重複あり\r\n          store.commit(\"message/addMessage\", {\r\n            level: \"warning\",\r\n            message: `重複したファイルが検出されました。${current.name}は追加されていません。`,\r\n            appname: \"mail/send\"\r\n          });\r\n          return [...prev];\r\n        }\r\n      }, []);\r\n      internalAttachments.value.length = 0;\r\n      // internalAttachmentsの上書き\r\n      uniques.forEach(f => { internalAttachments.value.push(f); });\r\n      store.commit(\"send/setAttachments\", uniques);\r\n    };\r\n\r\n    onBeforeMount(() => {\r\n      // confirmから戻ってきたときにVuexから取得する\r\n      attachments.value.forEach(a => {\r\n        internalAttachments.value.push(a);\r\n      });\r\n    });\r\n\r\n    return {\r\n      attachments, is_dirty, error_messages,\r\n      opened, internalAttachments,\r\n      onFileChange, dragEnter, dragLeave, dropFile, cansel\r\n    };\r\n  }\r\n};\r\n</script>\r\n\r\n<style scoped>\r\n.attachent-wrapper label *{\r\n  pointer-events: none;\r\n}\r\n\r\n.attachent-wrapper > label{\r\n  display: inline-block;\r\n  border: 1px dotted #d6eef5;\r\n  border-radius: 4px;\r\n  background-color: #f1f9fc;\r\n  padding: 0.5rem 1rem;\r\n  transition: .5s;\r\n}\r\n.attachent-wrapper > label.attachment-opened{\r\n  display: block;\r\n  width: 100%;\r\n  text-align: center;\r\n  padding: 4rem;\r\n}\r\n\r\n#attachment-input{\r\n  display: none;\r\n}\r\n\r\n.attachment-preview{\r\n  display: flex;\r\n  flex-wrap: wrap;\r\n  align-items: baseline;\r\n}\r\n.attachment-preview-wrapper{\r\n  position: relative;\r\n}\r\n\r\n.file-cansel{\r\n  position: absolute;\r\n  text-align: center;\r\n  top: 0;\r\n  right: 0;\r\n  border: 1px solid #aaa;\r\n  border-radius: 4px;\r\n  margin: 0.5rem;\r\n  width: 32px;\r\n  height: 32px;\r\n  line-height: 30px;\r\n  font-size: 20px;\r\n  background-color: rgba(255, 255, 255, 0.4);\r\n  transition: .2s;\r\n  z-index: 2;\r\n  cursor: pointer;\r\n}\r\n.file-cansel:hover{\r\n  background-color: rgba(255, 255, 255, 0.95);\r\n}\r\n\r\n</style>","<template>\r\n  <section>\r\n    <h3>メーリス送信確認</h3>\r\n\r\n    <div class=\"col-sm-12 col-md-10 col-lg-8 py-1 px-0 my-2 mx-0 display-wraper\">\r\n      <div class=\"p-1 label\">件名：</div>\r\n      <div class=\"p-1 border rounded display\">{{title}}</div>\r\n    </div>\r\n\r\n    <div class=\"col-sm-12 col-md-10 col-lg-8 py-1 px-0 my-2 mx-0 display-wraper\">\r\n      <div class=\"p-1 label\">送信先：</div>\r\n      <div class=\"p-1 border rounded display\">\r\n        <span v-for=\"obj in tos\" :key=\"obj.label\" class=\"badge badge-pill badge-light mx-2 border rounded\">{{obj.label}}</span>\r\n      </div>\r\n    </div>\r\n\r\n    <div class=\"col-sm-12 col-md-10 col-lg-8 py-1 px-0 my-2 mx-0 display-wraper\">\r\n      <div class=\"p-1 label\">本文：</div>\r\n      <div class=\"p-1 border rounded display\" style=\"white-space: pre-wrap;\" v-text=\"content\">\r\n      </div>\r\n    </div>\r\n\r\n    <div v-if=\"attachments.length\" class=\"col-sm-12 col-md-10 col-lg-8 py-1 px-0 my-2 mx-0 display-wraper\">\r\n      <div class=\"p-1 label\">添付ファイル：</div>\r\n      <div class=\"p-1 border rounded display attachment-wraper\">\r\n        <attachment-preview\r\n          v-for=\"file in attachments\"\r\n          :key=\"file.name+file.size\"\r\n          :file=\"file\"\r\n        />\r\n        <div class=\"mx-2\">{{attachments.length}}件添付</div>\r\n      </div>\r\n    </div>\r\n\r\n    <div class=\"col-sm-12 col-md-10 col-lg-8 py-1 px-0 my-4 mx-0\" id=\"send-button-wraper\">\r\n      <button @click=\"backToInput\" class=\"btn btn-secondary\">戻る</button>\r\n      <button @click=\"send\" class=\"btn btn-info\">送信する</button>\r\n    </div>\r\n  </section>\r\n</template>\r\n\r\n<script>\r\nimport { computed } from \"vue\";\r\nimport { useStore } from \"vuex\";\r\nimport { useRouter } from \"vue-router\";\r\nimport attachmentPreview from \"./components/send-input-attachment-preview\";\r\nexport default {\r\n  components: {\r\n    attachmentPreview\r\n  },\r\n  setup() {\r\n    const store = useStore();\r\n    const router = useRouter();\r\n    if (!store.getters[\"send/isValidAndDirty\"]) {\r\n      store.commit(\"message/addMessage\", {\r\n        level: \"warning\",\r\n        message: \"フォームに正しく入力してください。\",\r\n        appname: \"mail/send\"\r\n      });\r\n      router.push(\"/mail/send\");\r\n    }\r\n    const title = computed(() => store.state.send.title.value);\r\n    const tos = computed(() => store.state.send.tos.value);\r\n    const content = computed(() => store.state.send.content.value);\r\n    const writer = computed(() => store.state.send.writer.value);\r\n    const attachments = computed(() => store.state.send.attachments.value);\r\n\r\n    const backToInput = e => {\r\n      e.preventDefault();\r\n      router.push(\"/mail/send\");\r\n    };\r\n    const send = e => {\r\n      e.preventDefault();\r\n      store.dispatch(\"send/send\").then(res => {\r\n        // 正常にPOSTできた時。メーリスのトップページに遷移する\r\n        console.log(res);\r\n      }).catch(err => {\r\n        // 送信エラーが起こった時。遷移しない。\r\n        console.log(err);\r\n      });\r\n    };\r\n    return{\r\n      title, content, writer, attachments, tos,\r\n      backToInput, send\r\n    };\r\n  }\r\n};\r\n</script>\r\n\r\n<style scoped>\r\n.display-wraper{\r\n  display: flex;\r\n}\r\n.display-wraper .label{\r\n  flex-grow: 0;\r\n  flex-shrink: 0;\r\n  flex-basis: auto;\r\n}\r\n.display-wraper .display{\r\n  flex-grow: 2;\r\n  flex-shrink: 2;\r\n  flex-basis: auto;\r\n}\r\n#send-button-wraper{\r\n  display: flex;\r\n  justify-content: space-between;\r\n}\r\n\r\n.attachment-wraper{\r\n  display: flex;\r\n  flex-wrap: wrap;\r\n  align-items: baseline;\r\n}\r\n</style>"],"names":[],"sourceRoot":""}