{% extends "base.html" %}
{% load static %}

{% block main %}
<h2 class="fw-bold text-primary">
  <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor"
    stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-send">
    <path
      d="M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z" />
    <path d="m21.854 2.147-10.94 10.939" />
  </svg>
  メーリス送信
</h2>

<div class="d-flex justify-content-center align-items-center gap-2 my-4">
  <!-- Step 1 -->
  <div class="d-flex align-items-center">
    <div class="step bg-primary text-white rounded-pill px-3 py-2 fw-bold">① 入力</div>
    <span class="text-secondary fw-bold ms-2">≫</span>
  </div>
  <!-- Step 2 -->
  <div class="d-flex align-items-center">
    <div class="step bg-light text-secondary rounded-pill px-3 py-2 fw-bold">② 確認</div>
    <span class="text-secondary fw-bold ms-2">≫</span>
  </div>
  <!-- Step 3 -->
  <div class="d-flex align-items-center">
    <div class="step bg-light text-secondary rounded-pill px-3 py-2 fw-bold">③ 送信完了</div>
  </div>
</div>

<form method="post" enctype="multipart/form-data">
  {% csrf_token %}
  <!-- Wizard管理用のhidden (ダミーフォームなので必須) -->
  {{ wizard.management_form }}

  <!-- MessageForm -->
  {{ message_form.non_field_errors }}
  <div class="mb-3">
    <label for="{{ message_form.writer.id_for_label }}" class="form-label">
      {{ message_form.writer.label }}
    </label>
    {{ message_form.writer }}
    {{ message_form.writer.errors }}
  </div>
  <div class="mb-3">
    <label class="form-label">{{ message_form.to_groups.label }}</label>
    <div>
      {% for checkbox in message_form.to_groups %}
      <div class="form-check">
        {{ checkbox.tag|safe }}
        <label class="form-check-label" for="{{ checkbox.id_for_label }}">
          {{ checkbox.choice_label }}
        </label>
      </div>
      {% endfor %}
    </div>
    {% if message_form.to_groups.errors %}
    <div class="invalid-feedback d-block">
      {{ message_form.to_groups.errors }}
    </div>
    {% endif %}
  </div>
  <div class="mb-3">
    <label for="{{ message_form.title.id_for_label }}" class="form-label">
      {{ message_form.title.label }}
    </label>
    {{ message_form.title }}
    {{ message_form.title.errors }}
  </div>
  <div class="mb-3">
    <label for="{{ message_form.content.id_for_label }}" class="form-label">
      {{ message_form.content.label }}
    </label>
    {{ message_form.content }}
    {{ message_form.content.errors }}
  </div>


  <!-- AttachmentFormset -->
  {{ attachment_formset.management_form }}
  <label for="" class="form-label">添付ファイル</label>
  <div id="file-input-container">
    {% for form in attachment_formset %}
    <div class="mb-2">
      {{ form.file }}
      {% if form.file.errors %}
      <div class="invalid-feedback">
        {{ form.file.errors|join:", " }}
      </div>
      {% endif %}
    </div>
    {% endfor %}
  </div>
  <div class="mb-2">
    <button type="button" class="btn btn-outline-secondary w-100" id="add-file-button">
      <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none"
        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
        class="lucide lucide-file-plus">
        <path d="M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z" />
        <path d="M14 2v4a2 2 0 0 0 2 2h4" />
        <path d="M9 15h6" />
        <path d="M12 18v-6" />
      </svg>
      ファイルを追加
    </button>
  </div>

  <div class="d-flex my-3">
    <button type="submit" class="btn btn-primary ms-auto px-4">確認画面へ</button>
  </div>

</form>
<script src="{% static 'js/mail/mail_add_file_input.js' %}"></script>
{% endblock %}