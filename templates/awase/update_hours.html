{% extends 'base.html' %}
{% load static %}
{% load getsongdetail %}

{% block title %}{{calendar.title}}の集計時間を変更 | あわせのあわせ | Unplugged Message{% endblock %}
{% block extrastyle %}
    <link rel="stylesheet" type="text/css" href="{% static 'css/awase/create.css' %}">
    <script src='https://unpkg.com/v-calendar'></script>
{% endblock %}


{% block body %}
<h3><a href="{% url 'awase:calendar' calendar.pk %}">{{ calendar.title }}</a>の集計時間を変更</h3>
<p class="mb-4">
    各日にちの中で日程調整したい時間帯を変更できます。<br>
    時間は24時間表記で、9時(AM9:00)～26時(翌AM2:00)まで1時間単位で指定できます。<br>
    また、その日の集計を行わない場合は開始時間と終了時間に同じ数字を入れてください。<br>
    例：開始「9」、終了「9」 のとき、その日は集計を行いません。
</p>


<section id="app">
    <div v-if="!jsonLoaded">
        <p>読み込み中...</p>
    </div>
    <div v-else>
        <v-calendar
            :first-day-of-week="2"
            is-expanded
            :columns="$screens({ default: 1, ld: 2 })"
            >
            <template slot='header-title' slot-scope='props'>
                [[props.yearLabel]]年[[props.monthLabel]]
            </template>
            <template slot='day-content' slot-scope='props'>
                <div class="ceil text-center pt-1 pb-2" v-on:click="dayclick(props.day)">
                    <h6 class="m-0 p-0">[[props.day.day]]</h6>
                    <span class="small">22-26</span>
                </div>
            </template>

        </v-calendar>
        <button @click="clear()">選択を全て解除</button>
        <ul v-for="date in selectedDate">
            <li>[[dayToDisplayStr(date)]]</li>
        </ul>
    </div>
</section>


<script type="text/javascript">

let app = new Vue({
    el: '#app',
    delimiters: ['[[', ']]'],
    data: {
        jsonLoaded: true,
        selectedDate: [],
        isInline: true,
        WEEKDAYS: ['日','月','火','水','木','金','土']
    },
    methods: {
        dayclick: function(day){
            let is_exist = this.selectedDate.filter(function(item){
                return item.id === day.id
            });
            if (is_exist.length == 0) {
                this.selectedDate.push(day);
                day.isFocusable = true;
                // this.selectedDate.sort(function(a,b){
                //     return a.dateTime > b.dateTime;
                // });
                console.log(day);
            }
        },
        clear: function(){
            this.selectedDate = [];
        },
        // dateToYYYYMMDD: function(date){
        //     return date.getFullYear() + '' + (date.getMonth() + 1) + '' + date.getDate();
        // },
        dayToDisplayStr: function(day){
            return day.month + '/' + day.day + ' (' + this.WEEKDAYS[day.weekday - 1] + ')';
        }
    }
})

</script>

{% endblock %}